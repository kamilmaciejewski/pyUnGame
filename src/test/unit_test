import unittest
import sys
import os
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))
from neural.neuron import Neuron
from neural.neuronConnection import NeuronConnection
from neural.network import Network
from neural.networkDataHandler import NetworkDataHandler
from neural.networkData import NetworkData
from utils import geometry
import ung_globals

from random import randrange
from random import normalvariate
import pygame


def testHeader(testId):
    print("===============\nStarting test: " + testId+"\n")


class TestNeural(unittest.TestCase):
    def setUp(self):
        print("Init")
        pygame.init()
        print("Init done")
            
    def test_neruon(self):
        testHeader("test_neruon")
        
        data = NetworkData(2)
        
        n0 = Neuron(0, NetworkDataHandler(0, data), (0, 0))
        print("n0 body: " + str(n0.pos))
        self.assertEqual(n0.n_id, 0)
        
        n1 = Neuron(1,NetworkDataHandler(1, data), (10, 10))
        print("n1 body: " + str(n1.pos))
        dist = geometry.calculate_distance(n0.pos, n1.pos)
        print("Distance: " + str(dist))
        nc = NeuronConnection(n1, dist)
        n0.add_connection(nc)
        
        nc0 = n0.connections.__getitem__(0)
        
        print("conn : " + str(nc.weight))
        print("weight from neuron: " + str(nc0.weight))

    def test_nertwork(self):
        testHeader("test_network")
        
        network = Network(1, 2)
        #clear neurons
        network.neurons.clear
        
        #add new neurons
        n0 = Neuron(0, NetworkDataHandler(0, network.data), (0, 0, 5, 5))
        n1 = Neuron(1, NetworkDataHandler(1, network.data), (10, 10, 5, 5))
        network.neurons.append(n0)
        network.neurons.append(n1)
        network.init_connetctions()
        
        dist = geometry.calculate_distance(n0.pos, n1.pos)
        distPercent = dist/ung_globals.networkGraphSize
        
        print("Distance between neurons: " + str(dist))
        print("Distance between neurons as percent of the graph: " + str(distPercent))
        
        
        
        print("Network size: " + str(network.size))
        print("Network conn0 wieght: " + str(network.neurons.__getitem__(0).connections.__getitem__(0).weight))
        
        x = int(normalvariate(ung_globals.networkGraphSize/2,ung_globals.networkGraphSize/2))
        print("GAUSS: " + (str(x)))
        
        


if __name__ == "__main__":
    unittest.main()
